# Changelog

## Unreleased

### Compiler

- On the JavaScript target, bit arrays can now use the `unit` option to control
  the units of the `size` option.
  ([Surya Rose](https://github.com/GearsDatapacks))

- The compiler can now tell if string branches are unreachable. For example, the
  following code:

  ```gleam
  case a_string {
    "Hello, " <> name -> name
    "Hello, Jak" -> "Jak"
    _ -> "Stranger"
  }
  ```

  Will raise the following warning:

  ```
  warning: Unreachable case clause
    ┌─ /src/greet.gleam:7:5
    │
  7 │     "Hello, Jak" -> "Jak"
    │     ^^^^^^^^^^^^^^^^^^^^^

  This case clause cannot be reached as a previous clause matches the same
  values.

  Hint: It can be safely removed.
  ```

  ([Giacomo Cavalieri](https://github.com/giacomocavalieri))

- On the JavaScript target, blocks and various other expressions no longer
  compile to immediately invoked function expressions.
  ([Surya Rose](https://github.com/GearsDatapacks))

- On the JavaScript target, bit arrays can now use 16-bit floats in expressions
  and patterns.
  ([Richard Viney](https://github.com/richard-viney))

### Build tool

- Include a type annotation for the `main` function generated by `gleam new`.
  ([Drew Olson](https://github.com/drewolson))

### Language server

- The language server now allows renaming of functions and constants across
  modules. For example:

  ```gleam
  // wibble.gleam
  pub fn wibble() {
    wibble()
  //^ Trigger rename
  }
  // wobble.gleam
  import wibble

  pub fn main() {
    wibble.wibble()
  }
  ```

  Becomes:

  ```gleam
  // wibble.gleam
  pub fn wobble() {
    wobble()
  }
  // wobble.gleam
  import wibble

  pub fn main() {
    wibble.wobble()
  }
  ```

  ([Surya Rose](https://github.com/GearsDatapacks))

- The language server can now offer a code action to replace a `..` in a pattern
  with all the fields that are being ignored. For example triggering the code
  action on this spread:

  ```gleam
  pub type Pokemon {
    Pokemon(id: Int, name: String, moves: List(String))
  }

  pub fn main() {
    let Pokemon(..) = todo
    //          ^ If you put your cursor here
  }
  ```

  Would generate the following code:

  ```gleam
  pub type Pokemon {
    Pokemon(id: Int, name: String, moves: List(String))
  }

  pub fn main() {
    let Pokemon(id:, name:, moves:) = todo
  }
  ```

  ([Giacomo Cavalieri](https://github.com/giacomocavalieri))

- The function generated by the "Generate JSON encoder" code action has been
  slightly modified so that it will now fail to compile if the type has new
  fields added, ensuring the programmer remembers to re-run the code action.
  For example, for this type:

  ```gleam
  type Person {
    Person(name: String, age: Int)
  }
  ```

  The following code used to be generated:

  ```gleam
  fn encode_person(person: Person) -> json.Json {
    json.object([
      #("name", json.string(person.name)),
      #("age", json.int(person.age)),
    ])
  }
  ```

  But now, this code is generated:

  ```gleam
  fn encode_person(person: Person) -> json.Json {
    let Person(name:, age:) = person
    json.object([
      #("name", json.string(name)),
      #("age", json.int(age)),
    ])
  }
  ```

  ([Surya Rose](https://github.com/GearsDatapacks))

- The language server now supports finding references to values, both within
  a module and across multiple modules.
  ([Surya Rose](https://github.com/GearsDatapacks))

- The language server now offers a code action to remove all `echo`s in a
  module. For example:

  ```gleam
  pub fn main() {
    [1, 2, 3]
    |> echo
    // ^^^^ If you put your cursor over here
    |> list.filter(int.is_even)
    |> echo
  }
  ```

  Triggering the code action would remove all the `echo` pipeline steps:

  ```gleam
  pub fn main() {
    [1, 2, 3]
    |> list.filter(int.is_even)
  }
  ```

  This also works with all the `echo`s used before an expression:

  ```gleam
  pub fn main() {
    echo 1 + 2
  //^^^^^^^^^^ If hovering anywhere over here
  }
  ```

  Triggering the code action would remove the `echo`:

  ```gleam
  pub fn main() {
    1 + 2
  }
  ```

  ([Giacomo Cavalieri](https://github.com/giacomocavalieri))

### Formatter

### Bug fixes

- Fixed a bug where tuples with atoms in the first position could be
  incorrectly formatted by `echo`.
  ([Louis Pilfold](https://github.com/lpil))

- Fixed a bug where unlabelled arguments would be allowed after labelled
  arguments in variant constructor definitions.
  ([Surya Rose](https://github.com/GearsDatapacks))

- Fixed a bug where using the "Convert to pipe" code action on a function whose
  first argument is itself a pipe would result in invalid code.
  ([Giacomo Cavalieri](https://github.com/giacomocavalieri))

- Fixed a bug where using the "Convert to pipe" code action on a function or
  record capture produces invalid code.
  ([Matias Carlander](https://github.com/matiascr))

## v1.9.1 - 2025-03-10

### Formatter

- Improved the formatting of pipelines printed with `echo`.
  ([Giacomo Cavalieri](https://github.com/giacomocavalieri))

### Bug fixes

- Fixed a bug where `echo` used before a pipeline would generate invalid code
  for the Erlang target.
  ([Giacomo Cavalieri](https://github.com/giacomocavalieri))
